---
title: "Projectperiod"
author: "Beayonie Washington"
date: "2024-07-08"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
getwd()
```
# Load package

```{r}
library(readxl)
library(haven)
library(jsonlite)
library(openxlsx)
library(dplyr)
library(tidyverse)
```

# Import dataset
```{r}
#this source is from Abhaia
menopause<-read.csv("Menopausedata.csv")
menarche<-read.csv("Menarche.csv")
####

```

# Explore dataset 'menopause'
```{r}
head(menopause)
```
```{r}
library(Hmisc)
describe(menopause$country)
```

Interpretation: In 'menopause' dataset, the variable 'country' has 80 different categories.


# Explore dataset 'menarche'
```{r}
head(menarche)
```
Interpretation: Menarche doesn't have the same structure of menopause. why....

```{r}
library(Hmisc)
describe(menarche$country)
```
Interpretation: .... 18 countries in menarche dataset

In general: There are more countries in menopause instead of menarche
```{r}
combined_data<-merge(menarche,menopause,by="country")
```

```{r}
library(Hmisc)
describe(combined_data$country)
```
interpretation: 9 countries is in both dataset
BUGS
-not the same data structure and 
-different years in both datasets
-I need a code for the menopause data set to get keep first 4 four and get rid of DHS
-write code to transform the menopause data to look like the menarche data

# Tranformation 'menarche' data
```{r}
menarche <- menarche %>%
  select(-countrycode)  # Remove the country_code column)
```

# Tranformation 'menopause' data
```{r}
# Transforming the data
transformed_data <- menopause %>%
  pivot_longer(
    cols = starts_with("menopause"), 
    names_to = "menopause_age", 
    values_to = "value"
  ) %>%
  mutate(
    survey_year = sub("^([0-9]{4}).*", "\\1", survey),  # Extract the first four digits from the survey column
    menopause_age = str_replace(menopause_age, "menopause_", ""),  # Clean up menopause_age column
    menarche_age = "Not applicable"  # Since this data is about menopause, menarche_age is not applicable
  ) %>%
  select(country, survey_year, menopause_age, age, value)

# Inspect the transformed data
head(transformed_data)

```
interpretation: the data is transformed into the same structure as menarche data
but i'm not sure what "menopause_age" mean with the decmial point
-Survery_year does not have the "year" and DHS is still in the data

```{r}
library(dplyr)
library(tidyr)
library(stringr)

transformed_data <- menopause %>%
  pivot_longer(
    cols = starts_with("menopause"), 
    names_to = "menarche_age", 
    values_to = "value"
  ) %>%
  mutate(
    survey_year = as.integer(sub("^([0-9]{4}).*", "\\1", survey)),  # Extract the first four digits from the survey column
    menarche_age = str_replace(menarche_age, "menopause_", ""),  # Clean up menopause_age column
    menarche_age = gsub("\\.", "-", menarche_age),  # Replace period with hyphen
    menarche_age = paste("Age at menopause:", menarche_age),  # Add prefix
    current_age = NA  # Since this data is about menopause, menarche_age is not applicable
  ) %>%
  select(country, survey_year, menarche_age, current_age, value)

```

# Combine data

```{r}
# Append the datasets
combined_data <- bind_rows(menarche, transformed_data)
```

# Export the combined_data to a CSV file

```{r}
write.csv(combined_data, "combined_data.csv", row.names = FALSE)
```
